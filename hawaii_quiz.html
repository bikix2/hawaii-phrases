<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒº ãƒãƒ¯ã‚¤è‹±ä¼šè©±ã‚¯ã‚¤ã‚º - å®Œå…¨ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 600px;
            width: 100%;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            background: rgba(255,255,255,0.3);
            height: 8px;
            border-radius: 4px;
            margin-top: 15px;
            overflow: hidden;
        }
        
        .progress-fill {
            background: white;
            height: 100%;
            transition: width 0.3s;
        }
        
        .progress-text {
            margin-top: 8px;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .score {
            background: rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
        }
        
        /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ */
        .menu-screen {
            padding: 30px;
        }
        
        .menu-title {
            font-size: 18px;
            font-weight: bold;
            color: #212529;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .menu-grid {
            display: grid;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .menu-grid.scene-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .menu-grid.level-grid {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .menu-btn {
            padding: 15px 10px;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .menu-btn:hover {
            border-color: #4facfe;
            box-shadow: 0 4px 12px rgba(79,172,254,0.2);
        }
        
        .menu-btn-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 3px;
            color: #212529;
        }
        
        .menu-btn-desc {
            font-size: 12px;
            color: #6c757d;
        }
        
        .menu-btn.active {
            border-color: #4facfe;
            background: #e7f5ff;
        }
        
        .start-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .start-btn:active {
            transform: scale(0.98);
        }
        
        .stats-btn {
            width: 100%;
            padding: 15px;
            background: #f8f9fa;
            color: #212529;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 12px;
            transition: all 0.3s;
        }
        
        .stats-btn:hover {
            background: #e9ecef;
        }
        
        /* ã‚¯ã‚¤ã‚ºç”»é¢ */
        .content {
            padding: 30px;
        }
        
        .scene-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .level-badge {
            display: inline-block;
            background: #ffc107;
            color: #000;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .question-box {
            background: #f8f9fa;
            border-left: 5px solid #4facfe;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }
        
        .japanese-text {
            font-size: 22px;
            font-weight: bold;
            color: #212529;
            margin-bottom: 10px;
        }
        
        .hint-container {
            margin-top: 15px;
        }
        
        .hint-btn {
            background: #ffc107;
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .hint-btn:active {
            transform: scale(0.95);
        }
        
        .hint {
            font-size: 14px;
            color: #6c757d;
            font-style: italic;
            margin-top: 10px;
            padding: 10px;
            background: #fff3cd;
            border-radius: 8px;
            animation: slideIn 0.3s;
        }
        
        .speak-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: 10px;
        }
        
        .speak-btn:active {
            transform: scale(0.95);
        }
        
        .speak-btn.speaking {
            animation: pulse 1s infinite;
        }
        
        .input-wrapper {
            position: relative;
            margin-bottom: 15px;
        }
        
        .answer-input {
            width: 100%;
            padding: 15px 45px 15px 15px;
            font-size: 18px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79,172,254,0.1);
        }
        
        .clear-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: #dc3545;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .clear-btn.show {
            display: flex;
        }
        
        .clear-btn:active {
            transform: translateY(-50%) scale(0.9);
        }
        
        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .btn {
            padding: 15px 10px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            flex-direction: column;
        }
        
        .btn-check {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            grid-column: 1 / -1;
            font-size: 16px;
            flex-direction: row;
        }
        
        .btn-voice {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .btn-next {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }
        
        .btn-prev {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }
        
        .btn-menu {
            background: #6c757d;
            color: white;
            grid-column: 1 / -1;
            margin-top: 10px;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .recording {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .result {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .result.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .result.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .result.warning {
            background: #fff3cd;
            color: #856404;
            border: 2px solid #ffeeba;
        }
        
        .correct-answer {
            margin-top: 10px;
            font-size: 18px;
            color: #28a745;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .stat-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #4facfe;
        }
        
        .stat-label {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }
        
        /* çµæœç”»é¢ */
        .result-screen {
            padding: 30px;
            text-align: center;
        }
        
        .result-title {
            font-size: 28px;
            font-weight: bold;
            color: #212529;
            margin-bottom: 20px;
        }
        
        .result-emoji {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .result-stats {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .result-stat-item {
            margin: 15px 0;
            font-size: 18px;
        }
        
        .result-stat-label {
            color: #6c757d;
        }
        
        .result-stat-value {
            font-weight: bold;
            color: #4facfe;
            font-size: 24px;
        }
        
        /* çµ±è¨ˆç”»é¢ */
        .stats-screen {
            padding: 30px;
        }
        
        .stats-title {
            font-size: 24px;
            font-weight: bold;
            color: #212529;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .stats-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        
        .stats-card-title {
            font-size: 16px;
            font-weight: bold;
            color: #6c757d;
            margin-bottom: 10px;
        }
        
        .stats-card-value {
            font-size: 32px;
            font-weight: bold;
            color: #4facfe;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .reset-btn {
            width: 100%;
            padding: 15px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 600px) {
            .header h1 {
                font-size: 20px;
            }
            
            .japanese-text {
                font-size: 18px;
            }
            
            .answer-input {
                font-size: 16px;
            }
            
            .btn {
                font-size: 12px;
                padding: 12px 5px;
            }
            
            .result-emoji {
                font-size: 60px;
            }
            
            .menu-btn-title {
                font-size: 14px;
            }
            
            .menu-btn-desc {
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒº ãƒãƒ¯ã‚¤è‹±ä¼šè©±ã‚¯ã‚¤ã‚º</h1>
            <div class="score" id="scoreDisplay">
                ã‚¹ã‚³ã‚¢: <span id="score">0</span> / <span id="total">0</span>
            </div>
            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">å•é¡Œ 0 / 10</div>
        </div>
        
        <!-- ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ -->
        <div class="menu-screen" id="mainMenu">
            <div class="menu-title">ğŸ¯ ã‚·ãƒ¼ãƒ³ã‚’é¸æŠ</div>
            
            <div class="menu-grid scene-grid">
                <div class="menu-btn active" data-mode="random" onclick="selectScene('random')">
                    <div class="menu-btn-title">ğŸ”€ ãƒ©ãƒ³ãƒ€ãƒ </div>
                    <div class="menu-btn-desc">å…¨ã‚·ãƒ¼ãƒ³ã‹ã‚‰å‡ºé¡Œ</div>
                </div>
                <div class="menu-btn" data-mode="airport" onclick="selectScene('airport')">
                    <div class="menu-btn-title">âœˆï¸ ç©ºæ¸¯</div>
                    <div class="menu-btn-desc">å…¥å›½å¯©æŸ»ã€è·ç‰©å—å–</div>
                </div>
                <div class="menu-btn" data-mode="hotel" onclick="selectScene('hotel')">
                    <div class="menu-btn-title">ğŸ¨ ãƒ›ãƒ†ãƒ«</div>
                    <div class="menu-btn-desc">ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã€ã‚µãƒ¼ãƒ“ã‚¹</div>
                </div>
                <div class="menu-btn" data-mode="dining" onclick="selectScene('dining')">
                    <div class="menu-btn-title">ğŸ½ï¸ é£Ÿäº‹</div>
                    <div class="menu-btn-desc">æ³¨æ–‡ã€ä¼šè¨ˆ</div>
                </div>
                <div class="menu-btn" data-mode="shopping" onclick="selectScene('shopping')">
                    <div class="menu-btn-title">ğŸ›ï¸ è²·ã„ç‰©</div>
                    <div class="menu-btn-desc">è©¦ç€ã€æ”¯æ‰•ã„</div>
                </div>
                <div class="menu-btn" data-mode="transport" onclick="selectScene('transport')">
                    <div class="menu-btn-title">ğŸš— äº¤é€š</div>
                    <div class="menu-btn-desc">ãƒã‚¹ã€ã‚¿ã‚¯ã‚·ãƒ¼</div>
                </div>
                <div class="menu-btn" data-mode="emergency" onclick="selectScene('emergency')">
                    <div class="menu-btn-title">ğŸ†˜ ç·Šæ€¥</div>
                    <div class="menu-btn-desc">ç—…æ°—ã€ãƒˆãƒ©ãƒ–ãƒ«</div>
                </div>
            </div>
            
            <div class="menu-title" style="margin-top: 20px;">ğŸ“Š ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠ</div>
            <div class="menu-grid level-grid">
                <div class="menu-btn active" data-level="all" onclick="selectLevel('all')">
                    <div class="menu-btn-title">ğŸŒŸ å…¨ã¦</div>
                </div>
                <div class="menu-btn" data-level="beginner" onclick="selectLevel('beginner')">
                    <div class="menu-btn-title">ğŸŸ¢ åˆç´š</div>
                </div>
                <div class="menu-btn" data-level="advanced" onclick="selectLevel('advanced')">
                    <div class="menu-btn-title">ğŸ”´ ä¸Šç´š</div>
                </div>
            </div>
            
            <button class="start-btn" onclick="startQuiz()">ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹ ğŸš€</button>
            <button class="stats-btn" onclick="showStats()">ğŸ“Š å­¦ç¿’çµ±è¨ˆã‚’è¦‹ã‚‹</button>
        </div>
        
        <!-- ã‚¯ã‚¤ã‚ºç”»é¢ -->
        <div class="content hidden" id="quizScreen">
            <div class="scene-badge" id="scene">ç©ºæ¸¯ âœˆï¸</div>
            <span class="level-badge" id="levelBadge">åˆç´š</span>
            
            <div class="question-box">
                <div class="japanese-text" id="japanese">ãƒã‚±ãƒƒãƒˆ2æšãŠé¡˜ã„ã—ã¾ã™</div>
                <div class="hint-container">
                    <button class="hint-btn" id="hintBtn" onclick="toggleHint()">ğŸ’¡ ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹</button>
                    <button class="speak-btn" id="speakBtn" onclick="speakAnswer()">ğŸ”Š æ­£è§£ã‚’èã</button>
                    <div id="hintBox" class="hidden"></div>
                </div>
            </div>
            
            <div id="resultBox" class="hidden"></div>
            
            <div class="input-wrapper">
                <input 
                    type="text" 
                    id="answerInput" 
                    class="answer-input" 
                    placeholder="è‹±èªã§ç­”ãˆã¦ãã ã•ã„..."
                    autocomplete="off"
                >
                <button class="clear-btn" id="clearBtn" onclick="clearInput()">Ã—</button>
            </div>
            
            <button class="btn btn-check" id="checkBtn" onclick="checkAnswer()">
                å›ç­”ã‚’ãƒã‚§ãƒƒã‚¯ âœ“
            </button>
            
            <div class="button-group">
                <button class="btn btn-prev" id="prevBtn" onclick="previousQuestion()">
                    <span>â¬…ï¸</span>
                    <span>å‰ã®å•é¡Œ</span>
                </button>
                <button class="btn btn-voice" id="voiceBtn" onclick="toggleVoiceInput()">
                    <span id="voiceIcon">ğŸ¤</span>
                    <span id="voiceText">éŸ³å£°å…¥åŠ›</span>
                </button>
                <button class="btn btn-next" id="nextBtn" onclick="nextQuestion()">
                    <span>â¡ï¸</span>
                    <span>æ¬¡ã®å•é¡Œ</span>
                </button>
            </div>
            
            <button class="btn btn-menu" onclick="returnToMenu()">
                ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹
            </button>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="correct">0</div>
                    <div class="stat-label">æ­£è§£</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="incorrect">0</div>
                    <div class="stat-label">ä¸æ­£è§£</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="accuracy">0%</div>
                    <div class="stat-label">æ­£è§£ç‡</div>
                </div>
            </div>
        </div>
        
        <!-- çµæœç”»é¢ -->
        <div class="result-screen hidden" id="resultScreen">
            <div class="result-emoji" id="resultEmoji">ğŸ‰</div>
            <div class="result-title" id="resultTitle">ã‚¯ã‚¤ã‚ºå®Œäº†ï¼</div>
            
            <div class="result-stats">
                <div class="result-stat-item">
                    <div class="result-stat-label">æ­£è§£æ•°</div>
                    <div class="result-stat-value" id="finalCorrect">0</div>
                </div>
                <div class="result-stat-item">
                    <div class="result-stat-label">ä¸æ­£è§£æ•°</div>
                    <div class="result-stat-value" id="finalIncorrect">0</div>
                </div>
                <div class="result-stat-item">
                    <div class="result-stat-label">æ­£è§£ç‡</div>
                    <div class="result-stat-value" id="finalAccuracy">0%</div>
                </div>
            </div>
            
            <button class="start-btn" onclick="startQuiz()">ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸ ğŸ”„</button>
            <button class="stats-btn" onclick="returnToMenu()">ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
        </div>
        
        <!-- çµ±è¨ˆç”»é¢ -->
        <div class="stats-screen hidden" id="statsScreen">
            <div class="stats-title">ğŸ“Š å­¦ç¿’çµ±è¨ˆ</div>
            
            <div class="stats-card">
                <div class="stats-card-title">ç·å­¦ç¿’å›æ•°</div>
                <div class="stats-card-value" id="totalSessions">0</div>
            </div>
            
            <div class="stats-grid">
                <div class="stats-card">
                    <div class="stats-card-title">ç·æ­£è§£æ•°</div>
                    <div class="stats-card-value" id="totalCorrectStats">0</div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-title">ç·å•é¡Œæ•°</div>
                    <div class="stats-card-value" id="totalQuestionsStats">0</div>
                </div>
            </div>
            
            <div class="stats-card">
                <div class="stats-card-title">å¹³å‡æ­£è§£ç‡</div>
                <div class="stats-card-value" id="averageAccuracy">0%</div>
            </div>
            
            <button class="start-btn" onclick="returnToMenu()">ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹</button>
            <button class="reset-btn" onclick="resetStats()">çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
    </div>

    <script>
        // ============================================
        // ãƒ•ãƒ¬ãƒ¼ã‚ºãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
        // ============================================
        const phrasesDatabase = {
            airport: [
                { japanese: "ä¼‘æš‡ã§ã™", english: "Vacation.", hint: "1å˜èªã§ç­”ãˆã‚‰ã‚Œã¾ã™", level: "beginner", alternatives: ["For vacation", "I'm here for vacation"] },
                { japanese: "8æ—¥é–“ã§ã™", english: "Eight days.", hint: "æ•°å­— + days", level: "beginner", alternatives: ["For eight days"] },
                { japanese: "1é€±é–“ã§ã™", english: "One week.", hint: "One + æœŸé–“", level: "beginner", alternatives: ["For one week", "A week"] },
                { japanese: "ã‚¶ ã‚¤ãƒ³ãƒšãƒªã‚¢ãƒ« ãƒãƒ¯ã‚¤ ãƒªã‚¾ãƒ¼ãƒˆã§ã™", english: "At The Imperial Hawaii Resort.", hint: "At + ãƒ›ãƒ†ãƒ«å", level: "advanced", alternatives: ["The Imperial Hawaii Resort", "At Imperial Hawaii Resort"] },
                { japanese: "ã¯ã„ã€å®¶æ—5äººã§ã™", english: "Yes, we're a family of five.", hint: "Yes, we're a family of â—‹â—‹", level: "advanced", alternatives: ["Yes, we are a family of five", "Yes, five of us"] },
                { japanese: "ã™ã¿ã¾ã›ã‚“ã€æ‰‹è·ç‰©å—å–æ‰€ã¯ã©ã“ã§ã™ã‹?", english: "Excuse me, where's the baggage claim?", hint: "Excuse me, where is â—‹â—‹?", level: "advanced", alternatives: ["Excuse me, where is the baggage claim", "Where's the baggage claim", "Where is the baggage claim"] },
                { japanese: "ã„ã„ãˆã€ã‚ã‚Šã¾ã›ã‚“", english: "No, nothing to declare.", hint: "No, nothing â—‹â—‹", level: "advanced", alternatives: ["No, nothing", "Nothing to declare", "No"] },
                { japanese: "ã™ã¿ã¾ã›ã‚“ã€ã‚¿ã‚¯ã‚·ãƒ¼ä¹—ã‚Šå ´ã¯ã©ã“ã§ã™ã‹?", english: "Excuse me, where's the taxi stand?", hint: "Excuse me, where is â—‹â—‹?", level: "advanced", alternatives: ["Excuse me, where is the taxi stand", "Where's the taxi stand", "Where is the taxi stand"] },
                { japanese: "ã‚¶ ã‚¤ãƒ³ãƒšãƒªã‚¢ãƒ« ãƒãƒ¯ã‚¤ ãƒªã‚¾ãƒ¼ãƒˆã¾ã§ãŠé¡˜ã„ã—ã¾ã™", english: "The Imperial Hawaii Resort, please.", hint: "å ´æ‰€å + please", level: "beginner", alternatives: ["To The Imperial Hawaii Resort, please", "The Imperial Hawaii Resort"] },
                { japanese: "ã©ã‚Œãã‚‰ã„æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã‹?", english: "How long does it take?", hint: "How long â—‹â—‹?", level: "beginner", alternatives: ["How long will it take", "How long"] },
                { japanese: "ã„ãã‚‰ãã‚‰ã„ã§ã™ã‹?", english: "How much is it?", hint: "How much â—‹â—‹?", level: "beginner", alternatives: ["How much", "How much does it cost", "How much will it cost"] },
            ],
            hotel: [
                { japanese: "ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³å‰ã«è·ç‰©ã‚’é ã‘ãŸã„ã§ã™", english: "We'd like to leave our luggage before check-in.", hint: "We'd like to â—‹â—‹", level: "advanced", alternatives: ["We would like to leave our luggage before check-in", "Can we leave our luggage before check-in"] },
                { japanese: "è·ç‰©ã‚’ã“ã“ã«é ã‘ã‚‰ã‚Œã¾ã™ã‹?", english: "Can we store our bags here?", hint: "Can we â—‹â—‹ our bags here?", level: "advanced", alternatives: ["Can I store my bag here", "Can we leave our bags here"] },
                { japanese: "ä½è—¤ã®åå‰ã§äºˆç´„ã—ã¦ã„ã¾ã™", english: "We have a reservation under Sato.", hint: "We have a reservation under â—‹â—‹", level: "advanced", alternatives: ["I have a reservation under Sato", "Reservation under Sato"] },
                { japanese: "ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã§ã™ã€‚åå‰ã¯ä½è—¤ã§ã™", english: "Checking in. The name is Sato.", hint: "Checking in. The name is â—‹â—‹", level: "beginner", alternatives: ["Check in, please. Sato", "I'd like to check in. Sato"] },
                { japanese: "æœé£Ÿã¯ä½•æ™‚ã‹ã‚‰æä¾›ã•ã‚Œã¾ã™ã‹?", english: "What time is breakfast served?", hint: "What time is â—‹â—‹ served?", level: "advanced", alternatives: ["What time is breakfast", "When is breakfast served"] },
                { japanese: "åˆ©ç”¨ã§ãã‚‹ãƒ—ãƒ¼ãƒ«ã¯ã‚ã‚Šã¾ã™ã‹?", english: "Is there a pool we can use?", hint: "Is there a â—‹â—‹ we can use?", level: "advanced", alternatives: ["Do you have a pool", "Is there a pool"] },
                { japanese: "éƒ¨å±‹ã§WiFiã¯ä½¿ãˆã¾ã™ã‹?", english: "Is WiFi available in the rooms?", hint: "Is â—‹â—‹ available in the rooms?", level: "advanced", alternatives: ["Do you have WiFi in the rooms", "Is there WiFi in the rooms", "Can I use WiFi in my room"] },
                { japanese: "ã‚¨ã‚¢ã‚³ãƒ³ãŒå‹•ã„ã¦ã„ãªã„ã‚ˆã†ã§ã™", english: "The air conditioning doesn't seem to be working.", hint: "The â—‹â—‹ doesn't seem to be working", level: "advanced", alternatives: ["The air conditioning is not working", "The AC doesn't work", "The air conditioner is not working"] },
                { japanese: "éƒ¨å±‹ã‹ã‚‰ç· ã‚å‡ºã•ã‚Œã¾ã—ãŸ", english: "I'm locked out of my room.", hint: "I'm locked out of â—‹â—‹", level: "advanced", alternatives: ["I am locked out of my room", "I locked myself out"] },
                { japanese: "ã‚¿ã‚ªãƒ«ã‚’è¿½åŠ ã§ã‚‚ã‚‰ãˆã¾ã™ã‹?", english: "Could we get some extra towels?", hint: "Could we get â—‹â—‹?", level: "beginner", alternatives: ["Can we get extra towels", "Can I have extra towels", "Extra towels, please"] },
                { japanese: "å€Ÿã‚Šã‚‰ã‚Œã‚‹ç‚Šé£¯å™¨ã¯ã‚ã‚Šã¾ã™ã‹?", english: "Do you have a rice cooker we could borrow?", hint: "Do you have â—‹â—‹ we could borrow?", level: "advanced", alternatives: ["Can I borrow a rice cooker", "Do you have a rice cooker"] },
                { japanese: "æ¸…æƒã¯å¾Œã§æ¥ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹?", english: "Could you come back later for cleaning?", hint: "Could you come back later for â—‹â—‹?", level: "advanced", alternatives: ["Can you clean later", "Please come back later"] },
                { japanese: "ã‚¿ã‚¯ã‚·ãƒ¼ã‚’å‘¼ã‚“ã§ã„ãŸã ã‘ã¾ã™ã‹?", english: "Could you call a taxi for us?", hint: "Could you call â—‹â—‹ for us?", level: "advanced", alternatives: ["Can you call a taxi", "Please call a taxi"] },
            ],
            dining: [
                { japanese: "ç”°ä¸­ã§10äººã®äºˆç´„ã‚’ã—ã¦ã„ã¾ã™", english: "We have a reservation for ten people under Tanaka.", hint: "We have a reservation for â—‹â—‹ people under â—‹â—‹", level: "advanced", alternatives: ["Reservation for ten under Tanaka", "We have a reservation under Tanaka for ten"] },
                { japanese: "10äººã§ã™ã€‚äºˆç´„ã¯ã—ã¦ã„ã¾ã›ã‚“", english: "Ten people, please. No reservation.", hint: "â—‹â—‹ people, please. No reservation", level: "beginner", alternatives: ["Ten people, no reservation", "Party of ten, no reservation"] },
                { japanese: "10äººã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®å¾…ã¡æ™‚é–“ã¯ã©ã‚Œãã‚‰ã„ã§ã™ã‹?", english: "How long is the wait for a table for ten?", hint: "How long is the wait for â—‹â—‹?", level: "advanced", alternatives: ["How long is the wait for ten people", "What's the wait time for ten"] },
                { japanese: "å¤–ã®å¸­ã‚’ãŠé¡˜ã„ã§ãã¾ã™ã‹?", english: "Could we have a table outside, please?", hint: "Could we have a table â—‹â—‹?", level: "advanced", alternatives: ["Can we sit outside", "Outside table, please", "Table outside, please"] },
                { japanese: "çª“éš›ã«åº§ã‚Œã¾ã™ã‹?", english: "Can we sit near the window?", hint: "Can we sit near â—‹â—‹?", level: "beginner", alternatives: ["Can we have a window seat", "Window seat, please"] },
                { japanese: "ä½•ãŒãŠã™ã™ã‚ã§ã™ã‹?", english: "What do you recommend?", hint: "What do you â—‹â—‹?", level: "beginner", alternatives: ["What's your recommendation", "Any recommendations"] },
                { japanese: "ã“ã®æ–™ç†ã‚’èª¬æ˜ã—ã¦ã„ãŸã ã‘ã¾ã™ã‹?", english: "Can you explain this dish?", hint: "Can you explain â—‹â—‹?", level: "advanced", alternatives: ["Could you explain this dish", "What is this dish"] },
                { japanese: "ã‚µã‚¤ãƒ‰ãƒ‡ã‚£ãƒƒã‚·ãƒ¥ã¯ä»˜ãã¾ã™ã‹?", english: "Does it come with any sides?", hint: "Does it come with â—‹â—‹?", level: "advanced", alternatives: ["Does it come with sides", "Are there any sides"] },
                { japanese: "é‡ã¯ã©ã‚Œãã‚‰ã„ã§ã™ã‹?", english: "How big is the portion?", hint: "How big is â—‹â—‹?", level: "advanced", alternatives: ["How big are the portions", "What's the portion size"] },
                { japanese: "ãƒŸãƒ‡ã‚£ã‚¢ãƒ ã§ãŠé¡˜ã„ã—ã¾ã™", english: "Medium, please.", hint: "ç„¼ãåŠ æ¸› + please", level: "beginner", alternatives: ["I'd like it medium", "Medium"] },
                { japanese: "ãƒ”ã‚¯ãƒ«ã‚¹æŠœãã§ãŠé¡˜ã„ã—ã¾ã™", english: "No pickles, please.", hint: "No â—‹â—‹, please", level: "beginner", alternatives: ["Without pickles, please", "Hold the pickles"] },
                { japanese: "ãƒãƒ¼ã‚ºå¤šã‚ã§ãŠé¡˜ã„ã—ã¾ã™", english: "Extra cheese, please.", hint: "Extra â—‹â—‹, please", level: "beginner", alternatives: ["More cheese, please", "Extra cheese"] },
                { japanese: "ã‚·ã‚§ã‚¢ç”¨ã®è¿½åŠ ã®çš¿ã‚’ã„ãŸã ã‘ã¾ã™ã‹?", english: "Can we get extra plates for sharing?", hint: "Can we get extra â—‹â—‹ for sharing?", level: "advanced", alternatives: ["Can we have extra plates", "Extra plates, please"] },
                { japanese: "ä»Šã®ã¨ã“ã‚ä»¥ä¸Šã§ã™", english: "No, that's all for now.", hint: "No, that's all â—‹â—‹", level: "advanced", alternatives: ["That's all", "Nothing else", "That's it"] },
                { japanese: "ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã§ãã¾ã™ã‹?", english: "Could we get the check, please?", hint: "Could we get â—‹â—‹, please?", level: "beginner", alternatives: ["Check, please", "Can we have the check", "The bill, please"] },
                { japanese: "ä¼šè¨ˆã‚’åˆ†ã‘ã¦ã„ãŸã ã‘ã¾ã™ã‹?", english: "Can we split the check, please?", hint: "Can we split â—‹â—‹?", level: "advanced", alternatives: ["Can we split the bill", "Split check, please", "Separate checks, please"] },
                { japanese: "ä¸€ç·’ã«æ”¯æ‰•ã„ã¾ã™", english: "We'll pay together, please.", hint: "We'll pay â—‹â—‹", level: "beginner", alternatives: ["We'll pay together", "Together, please", "One check, please"] },
                { japanese: "ã‚«ãƒ¼ãƒ‰ã§ã™", english: "Here's my card.", hint: "Here's my â—‹â—‹", level: "beginner", alternatives: ["Here is my card", "My card"] },
                { japanese: "ã‚µãƒ¼ãƒ“ã‚¹æ–™ã¯æ—¢ã«å«ã¾ã‚Œã¦ã„ã¾ã™ã‹?", english: "Is gratuity already included?", hint: "Is â—‹â—‹ already included?", level: "advanced", alternatives: ["Is the tip included", "Is service charge included"] },
                { japanese: "ç¾é‡‘ã§æ‰•ãˆã¾ã™ã‹?", english: "Can I pay in cash?", hint: "Can I pay in â—‹â—‹?", level: "beginner", alternatives: ["Can I pay cash", "Is cash OK"] },
                { japanese: "é ˜åæ›¸ã‚’ã„ãŸã ã‘ã¾ã™ã‹?", english: "Can I have a receipt, please?", hint: "Can I have â—‹â—‹, please?", level: "beginner", alternatives: ["Receipt, please", "Can I get a receipt"] },
                { japanese: "ãŠæ°´ã®ãŠã‹ã‚ã‚Šã‚’ã„ãŸã ã‘ã¾ã™ã‹?", english: "Could we get some more water, please?", hint: "Could we get more â—‹â—‹?", level: "beginner", alternatives: ["More water, please", "Can we have more water", "Water refill, please"] },
                { japanese: "ã“ã‚Œã‚’æŒã¡å¸°ã‚Šç”¨ã®ç®±ã«å…¥ã‚Œã¦ã„ãŸã ã‘ã¾ã™ã‹?", english: "Could we get a box for this, please?", hint: "Could we get a box â—‹â—‹?", level: "advanced", alternatives: ["Can we get a to-go box", "Box, please", "Takeout box, please"] },
            ],
            shopping: [
                { japanese: "ã“ã‚Œã¯ã„ãã‚‰ã§ã™ã‹?", english: "How much is this?", hint: "How much â—‹â—‹?", level: "beginner", alternatives: ["How much", "How much does this cost", "What's the price"] },
                { japanese: "ã“ã‚Œã®Lã‚µã‚¤ã‚ºã¯ã‚ã‚Šã¾ã™ã‹?", english: "Do you have this in large?", hint: "Do you have this in â—‹â—‹?", level: "beginner", alternatives: ["Do you have this in a large", "Do you have a large", "Large size, please"] },
                { japanese: "è©¦ç€ã—ã¦ã‚‚ã„ã„ã§ã™ã‹?", english: "Can I try it on?", hint: "Can I try â—‹â—‹?", level: "beginner", alternatives: ["Can I try this on", "May I try it on"] },
                { japanese: "ã“ã®ã‚¯ãƒ¼ãƒãƒ³ã¯ä½¿ãˆã¾ã™ã‹?", english: "Can I use this coupon?", hint: "Can I use â—‹â—‹?", level: "beginner", alternatives: ["Can I use this", "Is this coupon valid"] },
                { japanese: "è¢‹ã‚’ãã ã•ã„", english: "Bag, please.", hint: "â—‹â—‹, please", level: "beginner", alternatives: ["Can I get a bag", "A bag, please", "Can I have a bag"] },
                { japanese: "ã‚«ãƒ¼ãƒ‰ã§æ‰•ãˆã¾ã™ã‹?", english: "Can I pay by card?", hint: "Can I pay by â—‹â—‹?", level: "beginner", alternatives: ["Can I pay with a card", "Can I use a card", "Card OK"] },
                { japanese: "ã“ã‚Œã‚’è³¼å…¥ã—ã¾ã™", english: "I'll take it.", hint: "I'll â—‹â—‹ it", level: "beginner", alternatives: ["I'll buy it", "I'd like to buy this", "I'll take this"] },
                { japanese: "èµ¤ã„ã®ã‚’ãŠé¡˜ã„ã—ã¾ã™", english: "Red one, please.", hint: "è‰² + one, please", level: "beginner", alternatives: ["The red one, please", "Red, please"] },
                { japanese: "å¤§ãã„ã®ã‚’ãŠé¡˜ã„ã—ã¾ã™", english: "Large one, please.", hint: "ã‚µã‚¤ã‚º + one, please", level: "beginner", alternatives: ["The large one, please", "Large, please", "A large, please"] },
            ],
            transport: [
                { japanese: "ã“ã®ãƒã‚¹ã¯ãƒ¯ã‚¤ã‚­ã‚­ã¸è¡Œãã¾ã™ã‹?", english: "Does this bus go to Waikiki?", hint: "Does this bus go to â—‹â—‹?", level: "advanced", alternatives: ["Is this bus going to Waikiki", "Does this go to Waikiki"] },
                { japanese: "ã“ã‚Œã¯ã‚¢ãƒ©ãƒ¢ã‚¢ãƒŠã‚»ãƒ³ã‚¿ãƒ¼è¡Œãã®æ­£ã—ã„ãƒã‚¹ã§ã™ã‹?", english: "Is this the right bus for Ala Moana Center?", hint: "Is this the right bus for â—‹â—‹?", level: "advanced", alternatives: ["Is this the bus to Ala Moana", "Does this go to Ala Moana Center"] },
                { japanese: "ã‚¢ãƒ©ãƒ¢ã‚¢ãƒŠã‚»ãƒ³ã‚¿ãƒ¼ã«ç€ã„ãŸã‚‰æ•™ãˆã¦ã„ãŸã ã‘ã¾ã™ã‹?", english: "Could you tell me when we get to Ala Moana Center?", hint: "Could you tell me when â—‹â—‹?", level: "advanced", alternatives: ["Can you tell me when we arrive at Ala Moana", "Please let me know when we get to Ala Moana"] },
                { japanese: "ã‚¤ãƒ³ãƒšãƒªã‚¢ãƒ« ãƒãƒ¯ã‚¤ ãƒªã‚¾ãƒ¼ãƒˆã¾ã§ãŠé¡˜ã„ã—ã¾ã™", english: "The Imperial Hawaii Resort, please.", hint: "å ´æ‰€å + please", level: "beginner", alternatives: ["To The Imperial Hawaii Resort, please", "Imperial Hawaii Resort"] },
                { japanese: "ã„ãã‚‰ãã‚‰ã„ã‹ã‹ã‚Šã¾ã™ã‹?", english: "How much will it cost?", hint: "How much will it â—‹â—‹?", level: "beginner", alternatives: ["How much is it", "How much", "What's the fare"] },
                { japanese: "ã“ã“ã§å¤§ä¸ˆå¤«ã§ã™", english: "Here is fine, thank you.", hint: "Here is â—‹â—‹", level: "beginner", alternatives: ["Here is fine", "Right here, please", "This is good"] },
            ],
            emergency: [
                { japanese: "ä½“èª¿ãŒæ‚ªã„ã§ã™", english: "I don't feel well.", hint: "I don't feel â—‹â—‹", level: "beginner", alternatives: ["I'm not feeling well", "I feel sick"] },
                { japanese: "åŒ»è€…ã«è¨ºã¦ã‚‚ã‚‰ã†å¿…è¦ãŒã‚ã‚Šã¾ã™", english: "I need to see a doctor.", hint: "I need to â—‹â—‹", level: "advanced", alternatives: ["I need a doctor", "I need medical help"] },
                { japanese: "é ­ãŒç—›ã„ã§ã™", english: "I have a headache.", hint: "I have a â—‹â—‹", level: "beginner", alternatives: ["My head hurts", "I have headache"] },
                { japanese: "ãŠè…¹ãŒç—›ã„ã§ã™", english: "I have a stomachache.", hint: "I have a â—‹â—‹", level: "beginner", alternatives: ["My stomach hurts", "I have stomach pain"] },
                { japanese: "ä¸‹ç—¢ã‚’ã—ã¦ã„ã¾ã™", english: "I have diarrhea.", hint: "I have â—‹â—‹", level: "advanced", alternatives: ["I'm having diarrhea"] },
                { japanese: "ä¹—ã‚Šç‰©é…”ã„ã—ã¦ã„ã¾ã™", english: "I have motion sickness.", hint: "I have â—‹â—‹ sickness", level: "advanced", alternatives: ["I'm feeling carsick", "I have car sickness"] },
            ],
        };

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let selectedScene = 'random';
        let selectedLevel = 'all';
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let correctCount = 0;
        let incorrectCount = 0;
        let userAnswers = [];
        let hasAnswered = false;

        // Web Speech API
        const synth = window.speechSynthesis;
        let recognition = null;
        let isRecording = false;

        // éŸ³å£°èªè­˜ã®åˆæœŸåŒ–
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = 'en-US';
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('answerInput').value = transcript;
                document.getElementById('clearBtn').classList.add('show');
            };

            recognition.onerror = function(event) {
                console.error('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼:', event.error);
                stopRecording();
                if (event.error === 'no-speech') {
                    alert('éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                } else if (event.error === 'not-allowed') {
                    alert('ãƒã‚¤ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                }
            };

            recognition.onend = function() {
                stopRecording();
            };
        }

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰çµ±è¨ˆã‚’èª­ã¿è¾¼ã‚€
        function loadStats() {
            const stats = JSON.parse(localStorage.getItem('hawaiiQuizStats')) || {
                totalSessions: 0,
                totalCorrect: 0,
                totalQuestions: 0
            };
            return stats;
        }

        // çµ±è¨ˆã‚’ä¿å­˜
        function saveStats(correct, total) {
            const stats = loadStats();
            stats.totalSessions += 1;
            stats.totalCorrect += correct;
            stats.totalQuestions += total;
            localStorage.setItem('hawaiiQuizStats', JSON.stringify(stats));
        }

        // çµ±è¨ˆã‚’è¡¨ç¤º
        function displayStats() {
            const stats = loadStats();
            document.getElementById('totalSessions').textContent = stats.totalSessions;
            document.getElementById('totalCorrectStats').textContent = stats.totalCorrect;
            document.getElementById('totalQuestionsStats').textContent = stats.totalQuestions;
            const avgAcc = stats.totalQuestions > 0 ? ((stats.totalCorrect / stats.totalQuestions) * 100).toFixed(1) : 0;
            document.getElementById('averageAccuracy').textContent = avgAcc + '%';
        }

        // ã‚·ãƒ¼ãƒ³é¸æŠ
        function selectScene(scene) {
            selectedScene = scene;
            document.querySelectorAll('[data-mode]').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-mode="${scene}"]`).classList.add('active');
        }

        // ãƒ¬ãƒ™ãƒ«é¸æŠ
        function selectLevel(level) {
            selectedLevel = level;
            document.querySelectorAll('[data-level]').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-level="${level}"]`).classList.add('active');
        }

        // ã‚¯ã‚¤ã‚ºé–‹å§‹
        function startQuiz() {
            let allPhrases = [];

            if (selectedScene === 'random') {
                // å…¨ã‚·ãƒ¼ãƒ³ã‹ã‚‰é¸æŠ
                for (let scene in phrasesDatabase) {
                    const scenePhrases = phrasesDatabase[scene];
                    if (selectedLevel === 'all') {
                        allPhrases = allPhrases.concat(scenePhrases);
                    } else {
                        const filtered = scenePhrases.filter(p => p.level === selectedLevel);
                        allPhrases = allPhrases.concat(filtered);
                    }
                }
            } else {
                // ç‰¹å®šã®ã‚·ãƒ¼ãƒ³ã‹ã‚‰é¸æŠ
                const scenePhrases = phrasesDatabase[selectedScene];
                if (selectedLevel === 'all') {
                    allPhrases = scenePhrases;
                } else {
                    allPhrases = scenePhrases.filter(p => p.level === selectedLevel);
                }
            }

            if (allPhrases.length === 0) {
                alert('é¸æŠã—ãŸæ¡ä»¶ã§ã¯å•é¡ŒãŒä½œæˆã§ãã¾ã›ã‚“ã€‚æ¡ä»¶ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // ãƒ©ãƒ³ãƒ€ãƒ ã«å•é¡Œã‚’é¸æŠï¼ˆæœ€å¤§10å•ã€ã¾ãŸã¯åˆ©ç”¨å¯èƒ½ãªå…¨å•é¡Œï¼‰
            const maxQuestions = Math.min(10, allPhrases.length);
            currentQuestions = [];
            const shuffled = allPhrases.sort(() => 0.5 - Math.random());
            currentQuestions = shuffled.slice(0, maxQuestions);

            // åˆæœŸåŒ–
            currentQuestionIndex = 0;
            correctCount = 0;
            incorrectCount = 0;
            userAnswers = new Array(maxQuestions).fill({ answered: false, correct: false, userAnswer: '' });

            // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            document.getElementById('resultScreen').classList.add('hidden');
            document.getElementById('statsScreen').classList.add('hidden');

            showQuestion();
            updateProgress();
        }

        // å•é¡Œã‚’è¡¨ç¤º
        function showQuestion() {
            hasAnswered = userAnswers[currentQuestionIndex].answered;

            const question = currentQuestions[currentQuestionIndex];
            
            // ã‚·ãƒ¼ãƒ³åã¨ã‚¢ã‚¤ã‚³ãƒ³ã®è¨­å®š
            const sceneNames = {
                'airport': 'âœˆï¸ ç©ºæ¸¯',
                'hotel': 'ğŸ¨ ãƒ›ãƒ†ãƒ«',
                'dining': 'ğŸ½ï¸ é£Ÿäº‹',
                'shopping': 'ğŸ›ï¸ è²·ã„ç‰©',
                'transport': 'ğŸš— äº¤é€š',
                'emergency': 'ğŸ†˜ ç·Šæ€¥'
            };
            
            // ãƒ•ãƒ¬ãƒ¼ã‚ºãŒã©ã®ã‚·ãƒ¼ãƒ³ã«å±ã—ã¦ã„ã‚‹ã‹æ¤œç´¢
            let questionScene = 'ãƒ©ãƒ³ãƒ€ãƒ ';
            for (let scene in phrasesDatabase) {
                if (phrasesDatabase[scene].includes(question)) {
                    questionScene = sceneNames[scene] || scene;
                    break;
                }
            }
            
            document.getElementById('scene').textContent = questionScene;
            document.getElementById('levelBadge').textContent = question.level === 'beginner' ? 'åˆç´š' : 'ä¸Šç´š';
            document.getElementById('japanese').textContent = question.japanese;
            document.getElementById('hintBox').textContent = question.hint;
            document.getElementById('hintBox').classList.add('hidden');
            
            // ä»¥å‰ã®å›ç­”ãŒã‚ã‚Œã°è¡¨ç¤º
            const previousAnswer = userAnswers[currentQuestionIndex].userAnswer || '';
            document.getElementById('answerInput').value = previousAnswer;

            // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('resultBox').classList.add('hidden');
            document.getElementById('resultBox').innerHTML = '';

            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;

            // éŸ³å£°å…¥åŠ›ãŒé€²è¡Œä¸­ãªã‚‰åœæ­¢
            if (isRecording) {
                stopRecording();
            }

            updateSessionStats();
            updateProgress();
        }

        // ãƒ’ãƒ³ãƒˆè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleHint() {
            const hintBox = document.getElementById('hintBox');
            hintBox.classList.toggle('hidden');
        }

        // éŸ³å£°å†ç”Ÿ
        function speakAnswer() {
            if (synth.speaking) {
                synth.cancel();
                return;
            }

            const question = currentQuestions[currentQuestionIndex];
            const utterance = new SpeechSynthesisUtterance(question.english);
            utterance.lang = 'en-US';
            utterance.rate = 0.9;
            utterance.pitch = 1.0;
            utterance.volume = 1.0;

            const speakBtn = document.getElementById('speakBtn');
            speakBtn.classList.add('speaking');
            
            utterance.onend = () => {
                speakBtn.classList.remove('speaking');
            };

            synth.speak(utterance);
        }

        // éŸ³å£°å…¥åŠ›åˆ‡ã‚Šæ›¿ãˆ
        function toggleVoiceInput() {
            if (!recognition) {
                alert('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°å…¥åŠ›ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚Chromeã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
                return;
            }

            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        // éŸ³å£°å…¥åŠ›é–‹å§‹
        function startRecording() {
            isRecording = true;
            document.getElementById('voiceBtn').classList.add('recording');
            document.getElementById('voiceIcon').textContent = 'âºï¸';
            document.getElementById('voiceText').textContent = 'éŒ²éŸ³ä¸­...';
            recognition.start();
        }

        // éŸ³å£°å…¥åŠ›åœæ­¢
        function stopRecording() {
            isRecording = false;
            document.getElementById('voiceBtn').classList.remove('recording');
            document.getElementById('voiceIcon').textContent = 'ğŸ¤';
            document.getElementById('voiceText').textContent = 'éŸ³å£°å…¥åŠ›';
            if (recognition) {
                recognition.stop();
            }
        }

        // å…¥åŠ›ã‚¯ãƒªã‚¢
        function clearInput() {
            document.getElementById('answerInput').value = '';
            document.getElementById('clearBtn').classList.remove('show');
        }

        // å…¥åŠ›ç›£è¦–ï¼ˆã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³è¡¨ç¤ºï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('answerInput');
            const clearBtn = document.getElementById('clearBtn');
            
            input.addEventListener('input', function() {
                if (input.value.length > 0) {
                    clearBtn.classList.add('show');
                } else {
                    clearBtn.classList.remove('show');
                }
            });

            // Enterã‚­ãƒ¼ã§å›ç­”
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });
        });

        // å›ç­”ã®æ­£è¦åŒ–
        function normalizeAnswer(answer) {
            let normalized = answer.toLowerCase().trim();

            // çœç•¥å½¢ã®å±•é–‹
            const contractions = {
                "i'm": "i am",
                "i'd": "i would",
                "i'll": "i will",
                "i've": "i have",
                "you're": "you are",
                "you'd": "you would",
                "you'll": "you will",
                "you've": "you have",
                "he's": "he is",
                "he'd": "he would",
                "he'll": "he will",
                "she's": "she is",
                "she'd": "she would",
                "she'll": "she will",
                "it's": "it is",
                "it'd": "it would",
                "it'll": "it will",
                "we're": "we are",
                "we'd": "we would",
                "we'll": "we will",
                "we've": "we have",
                "they're": "they are",
                "they'd": "they would",
                "they'll": "they will",
                "they've": "they have",
                "that's": "that is",
                "what's": "what is",
                "where's": "where is",
                "who's": "who is",
                "how's": "how is",
                "there's": "there is",
                "can't": "cannot",
                "won't": "will not",
                "don't": "do not",
                "doesn't": "does not",
                "didn't": "did not",
                "isn't": "is not",
                "aren't": "are not",
                "wasn't": "was not",
                "weren't": "were not",
                "haven't": "have not",
                "hasn't": "has not",
                "hadn't": "had not"
            };

            for (let [contracted, expanded] of Object.entries(contractions)) {
                normalized = normalized.replace(new RegExp('\\b' + contracted + '\\b', 'g'), expanded);
            }

            // å¥èª­ç‚¹ã‚’å‰Šé™¤
            normalized = normalized.replace(/[?!.,]/g, '');

            return normalized;
        }

        // å›ç­”ãƒã‚§ãƒƒã‚¯
        function checkAnswer() {
            const userAnswer = document.getElementById('answerInput').value;
            if (!userAnswer.trim()) {
                alert('å›ç­”ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const question = currentQuestions[currentQuestionIndex];
            const normalizedUser = normalizeAnswer(userAnswer);
            const normalizedCorrect = normalizeAnswer(question.english);

            // ä»£æ›¿è¡¨ç¾ã‚’æ­£è¦åŒ–
            const alternatives = [normalizedCorrect];
            if (question.alternatives) {
                question.alternatives.forEach(alt => {
                    alternatives.push(normalizeAnswer(alt));
                });
            }

            const isCorrect = alternatives.some(alt => normalizedUser === alt);

            const resultBox = document.getElementById('resultBox');
            if (isCorrect) {
                if (!hasAnswered) {
                    correctCount++;
                    hasAnswered = true;
                }
                resultBox.className = 'result correct';
                resultBox.innerHTML = `âœ… æ­£è§£ï¼<div class="correct-answer">${question.english}</div>`;
                userAnswers[currentQuestionIndex] = { answered: true, correct: true, userAnswer: userAnswer };
            } else {
                if (!hasAnswered) {
                    incorrectCount++;
                    hasAnswered = true;
                }
                resultBox.className = 'result incorrect';
                resultBox.innerHTML = `âŒ ä¸æ­£è§£<div class="correct-answer">æ­£è§£: ${question.english}</div>`;
                userAnswers[currentQuestionIndex] = { answered: true, correct: false, userAnswer: userAnswer };
            }

            resultBox.classList.remove('hidden');
            updateSessionStats();
            updateProgress();
        }

        // å‰ã®å•é¡Œ
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        // æ¬¡ã®å•é¡Œ
        function nextQuestion() {
            // æœªå›ç­”ã®å ´åˆã¯ä¸æ­£è§£ã¨ã—ã¦ã‚«ã‚¦ãƒ³ãƒˆ
            if (!hasAnswered) {
                incorrectCount++;
                userAnswers[currentQuestionIndex] = { answered: true, correct: false, userAnswer: '' };
                
                const resultBox = document.getElementById('resultBox');
                resultBox.className = 'result warning';
                resultBox.innerHTML = 'âš ï¸ æœªå›ç­”ã®ãŸã‚ä¸æ­£è§£ã¨ãªã‚Šã¾ã—ãŸ';
                resultBox.classList.remove('hidden');
                
                updateSessionStats();
                
                // 1.5ç§’å¾Œã«æ¬¡ã®å•é¡Œã¸
                setTimeout(() => {
                    proceedToNext();
                }, 1500);
            } else {
                proceedToNext();
            }
        }

        // æ¬¡ã®å•é¡Œã«é€²ã‚€å‡¦ç†
        function proceedToNext() {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            } else {
                showResult();
            }
        }

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ±è¨ˆæ›´æ–°
        function updateSessionStats() {
            document.getElementById('correct').textContent = correctCount;
            document.getElementById('incorrect').textContent = incorrectCount;
            const total = correctCount + incorrectCount;
            const accuracy = total > 0 ? ((correctCount / total) * 100).toFixed(0) : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
        function updateProgress() {
            const totalQuestions = currentQuestions.length;
            const progress = ((currentQuestionIndex + 1) / totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `å•é¡Œ ${currentQuestionIndex + 1} / ${totalQuestions}`;
            document.getElementById('score').textContent = correctCount;
            document.getElementById('total').textContent = correctCount + incorrectCount;
        }

        // çµæœè¡¨ç¤º
        function showResult() {
            const totalQuestions = currentQuestions.length;
            saveStats(correctCount, totalQuestions);
            
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('resultScreen').classList.remove('hidden');

            document.getElementById('finalCorrect').textContent = correctCount;
            document.getElementById('finalIncorrect').textContent = incorrectCount;
            const accuracy = ((correctCount / totalQuestions) * 100).toFixed(0);
            document.getElementById('finalAccuracy').textContent = accuracy + '%';

            // çµæœã«å¿œã˜ãŸçµµæ–‡å­—ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            let emoji = 'ğŸ‰';
            let title = 'ã‚¯ã‚¤ã‚ºå®Œäº†ï¼';
            if (correctCount === 10) {
                emoji = 'ğŸ†';
                title = 'ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼';
            } else if (correctCount >= 7) {
                emoji = 'ğŸ‰';
                title = 'ç´ æ™´ã‚‰ã—ã„ï¼';
            } else if (correctCount >= 5) {
                emoji = 'ğŸ‘';
                title = 'ã‚ˆãã§ãã¾ã—ãŸï¼';
            } else {
                emoji = 'ğŸ’ª';
                title = 'æ¬¡ã¯é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼';
            }

            document.getElementById('resultEmoji').textContent = emoji;
            document.getElementById('resultTitle').textContent = title;
        }

        // çµ±è¨ˆç”»é¢è¡¨ç¤º
        function showStats() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('statsScreen').classList.remove('hidden');
            displayStats();
        }

        // çµ±è¨ˆãƒªã‚»ãƒƒãƒˆ
        function resetStats() {
            if (confirm('å­¦ç¿’çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem('hawaiiQuizStats');
                displayStats();
            }
        }

        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹
        function returnToMenu() {
            // éŸ³å£°å…¥åŠ›ãŒé€²è¡Œä¸­ãªã‚‰åœæ­¢
            if (isRecording) {
                stopRecording();
            }
            
            document.getElementById('mainMenu').classList.remove('hidden');
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('resultScreen').classList.add('hidden');
            document.getElementById('statsScreen').classList.add('hidden');
        }
    </script>
</body>
</html>